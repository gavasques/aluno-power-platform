# Plano de ImplementaÃ§Ã£o - MÃ³dulo FinanÃ§as360

## ğŸ“‹ VisÃ£o Geral

IntegraÃ§Ã£o completa do sistema de gestÃ£o financeira FinanÃ§as360 dentro do sistema atual, com foco em controle de finanÃ§as empresariais, incluindo cadastros e operaÃ§Ãµes financeiras.

## ğŸ¯ Objetivos

1. Criar mÃ³dulo FinanÃ§as360 dentro de "Minha Ãrea"
2. Implementar todos os cadastros financeiros
3. Implementar todas as operaÃ§Ãµes financeiras
4. Integrar com sistema de permissÃµes existente
5. Usar prefixo `fin360_` em todas as tabelas para evitar conflitos

## ğŸ—ï¸ Arquitetura

### Estrutura de Pastas
```
client/src/
â”œâ”€â”€ pages/myarea/financas360/
â”‚   â”œâ”€â”€ Financas360Index.tsx          # PÃ¡gina principal com cards
â”‚   â”œâ”€â”€ cadastros/
â”‚   â”‚   â”œâ”€â”€ Empresas.tsx
â”‚   â”‚   â”œâ”€â”€ Canais.tsx
â”‚   â”‚   â”œâ”€â”€ Bancos.tsx
â”‚   â”‚   â”œâ”€â”€ ContasBancarias.tsx
â”‚   â”‚   â”œâ”€â”€ FormasPagamento.tsx
â”‚   â”‚   â”œâ”€â”€ Parceiros.tsx
â”‚   â”‚   â”œâ”€â”€ CanaisPagamento.tsx
â”‚   â”‚   â””â”€â”€ EstruturaDRE.tsx
â”‚   â””â”€â”€ operacoes/
â”‚       â”œâ”€â”€ Lancamentos.tsx
â”‚       â”œâ”€â”€ NotasFiscais.tsx
â”‚       â””â”€â”€ Devolucoes.tsx
â”œâ”€â”€ components/financas360/
â”‚   â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ forms/
â”‚   â””â”€â”€ tables/
â”œâ”€â”€ hooks/financas360/
â”œâ”€â”€ lib/services/financas360/
â””â”€â”€ shared/types/financas360/

server/
â”œâ”€â”€ routes/financas360/
â”œâ”€â”€ services/financas360/
â””â”€â”€ migrations/financas360/
```

## ğŸ“Š Estrutura de Dados

### Tabelas do Banco de Dados

#### 1. fin360_empresas
```sql
- id: serial primary key
- razao_social: varchar(255) not null
- nome_fantasia: varchar(255)
- cnpj: varchar(14) unique not null
- inscricao_estadual: varchar(20)
- inscricao_municipal: varchar(20)
- endereco: jsonb
- telefone: varchar(20)
- email: varchar(255)
- logo_url: text
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 2. fin360_canais
```sql
- id: serial primary key
- nome: varchar(100) not null
- descricao: text
- tipo: varchar(50) -- 'vendas', 'compras', 'servicos'
- cor: varchar(7) -- cor hexadecimal
- icone: varchar(50)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 3. fin360_bancos
```sql
- id: serial primary key
- codigo: varchar(10) unique not null
- nome: varchar(100) not null
- nome_completo: varchar(255)
- website: varchar(255)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
```

#### 4. fin360_contas_bancarias
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id)
- banco_id: integer references fin360_bancos(id)
- tipo_conta: varchar(20) -- 'corrente', 'poupanca', 'investimento'
- agencia: varchar(10) not null
- conta: varchar(20) not null
- digito: varchar(2)
- descricao: varchar(255)
- saldo_inicial: decimal(12,2) default 0
- saldo_atual: decimal(12,2) default 0
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 5. fin360_formas_pagamento
```sql
- id: serial primary key
- nome: varchar(100) not null
- tipo: varchar(50) -- 'dinheiro', 'cartao_credito', 'cartao_debito', 'pix', 'boleto', 'transferencia'
- taxa_percentual: decimal(5,2) default 0
- taxa_fixa: decimal(10,2) default 0
- prazo_recebimento: integer default 0 -- em dias
- conta_bancaria_id: integer references fin360_contas_bancarias(id)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 6. fin360_parceiros
```sql
- id: serial primary key
- tipo: varchar(20) -- 'cliente', 'fornecedor', 'ambos'
- razao_social: varchar(255)
- nome_fantasia: varchar(255)
- cpf_cnpj: varchar(14) unique
- inscricao_estadual: varchar(20)
- endereco: jsonb
- telefone: varchar(20)
- email: varchar(255)
- observacoes: text
- limite_credito: decimal(12,2) default 0
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 7. fin360_canais_pagamento
```sql
- id: serial primary key
- nome: varchar(100) not null
- tipo: varchar(50) -- 'gateway', 'maquininha', 'banco', 'fintech'
- taxa_percentual: decimal(5,2) default 0
- taxa_fixa: decimal(10,2) default 0
- prazo_recebimento: integer default 0
- configuracoes: jsonb -- API keys, etc (encrypted)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 8. fin360_estrutura_dre
```sql
- id: serial primary key
- codigo: varchar(20) unique not null
- descricao: varchar(255) not null
- tipo: varchar(20) -- 'receita', 'custo', 'despesa'
- nivel: integer not null -- 1, 2, 3 (hierarquia)
- pai_id: integer references fin360_estrutura_dre(id)
- ordem: integer
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 9. fin360_lancamentos
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- tipo: varchar(20) -- 'receita', 'despesa'
- data_lancamento: date not null
- data_vencimento: date not null
- data_pagamento: date
- parceiro_id: integer references fin360_parceiros(id)
- conta_bancaria_id: integer references fin360_contas_bancarias(id)
- forma_pagamento_id: integer references fin360_formas_pagamento(id)
- canal_id: integer references fin360_canais(id)
- estrutura_dre_id: integer references fin360_estrutura_dre(id)
- descricao: varchar(255) not null
- valor: decimal(12,2) not null
- valor_pago: decimal(12,2)
- juros: decimal(10,2) default 0
- multa: decimal(10,2) default 0
- desconto: decimal(10,2) default 0
- status: varchar(20) -- 'pendente', 'pago', 'cancelado', 'vencido'
- observacoes: text
- anexos: jsonb -- array de URLs
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 10. fin360_notas_fiscais
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- numero: varchar(20) not null
- serie: varchar(10)
- chave_acesso: varchar(44) unique
- tipo: varchar(20) -- 'entrada', 'saida'
- data_emissao: date not null
- data_entrada: date
- parceiro_id: integer references fin360_parceiros(id)
- valor_produtos: decimal(12,2) not null
- valor_desconto: decimal(10,2) default 0
- valor_frete: decimal(10,2) default 0
- valor_seguro: decimal(10,2) default 0
- outras_despesas: decimal(10,2) default 0
- valor_total: decimal(12,2) not null
- observacoes: text
- xml_url: text
- pdf_url: text
- status: varchar(20) -- 'autorizada', 'cancelada', 'inutilizada'
- lancamentos: jsonb -- array de IDs dos lanÃ§amentos vinculados
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 11. fin360_devolucoes
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- tipo: varchar(20) -- 'cliente', 'fornecedor'
- data: date not null
- parceiro_id: integer references fin360_parceiros(id)
- nota_fiscal_id: integer references fin360_notas_fiscais(id)
- motivo: text not null
- valor: decimal(12,2) not null
- status: varchar(20) -- 'pendente', 'processada', 'cancelada'
- lancamento_id: integer references fin360_lancamentos(id)
- observacoes: text
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

## ğŸ”§ Plano de ImplementaÃ§Ã£o

### Fase 1: PreparaÃ§Ã£o e Estrutura Base
- [ ] Criar estrutura de pastas para o mÃ³dulo FinanÃ§as360
- [ ] Configurar rotas base no App.tsx
- [ ] Criar pÃ¡gina Financas360Index.tsx com cards de navegaÃ§Ã£o
- [ ] Adicionar card "FinanÃ§as360" em MinhaAreaIndex.tsx
- [ ] Criar tipos TypeScript base em shared/types/financas360/
- [ ] Configurar permissÃµes no sistema de autenticaÃ§Ã£o

### Fase 2: Schema e MigraÃ§Ãµes do Banco
- [ ] Criar schema completo em shared/schema/financas360.ts
- [ ] Implementar migraÃ§Ãµes para todas as tabelas
- [ ] Executar migraÃ§Ãµes no banco de dados
- [ ] Criar Ã­ndices para otimizaÃ§Ã£o

### Fase 3: ServiÃ§os Backend
- [ ] Criar serviÃ§os base para CRUD de cada entidade
- [ ] Implementar validaÃ§Ãµes com Zod
- [ ] Criar rotas da API para cada mÃ³dulo
- [ ] Implementar middleware de autenticaÃ§Ã£o/autorizaÃ§Ã£o
- [ ] Criar testes unitÃ¡rios para serviÃ§os

### Fase 4: Cadastros BÃ¡sicos
- [ ] Implementar CRUD de Empresas
- [ ] Implementar CRUD de Canais
- [ ] Implementar CRUD de Bancos
- [ ] Implementar CRUD de Contas BancÃ¡rias
- [ ] Implementar CRUD de Formas de Pagamento
- [ ] Implementar CRUD de Parceiros
- [ ] Implementar CRUD de Canais de Pagamento
- [ ] Implementar CRUD de Estrutura DRE

### Fase 5: OperaÃ§Ãµes Financeiras
- [ ] Implementar sistema de LanÃ§amentos
  - [ ] Criar lanÃ§amento
  - [ ] Editar lanÃ§amento
  - [ ] Baixar/Pagar lanÃ§amento
  - [ ] Cancelar lanÃ§amento
  - [ ] Filtros e relatÃ³rios
- [ ] Implementar gestÃ£o de Notas Fiscais
  - [ ] Upload de XML
  - [ ] Parser de XML
  - [ ] VinculaÃ§Ã£o com lanÃ§amentos
  - [ ] RelatÃ³rios fiscais
- [ ] Implementar sistema de DevoluÃ§Ãµes
  - [ ] Criar devoluÃ§Ã£o
  - [ ] Processar devoluÃ§Ã£o
  - [ ] Gerar lanÃ§amentos de devoluÃ§Ã£o

### Fase 6: Dashboards e RelatÃ³rios
- [ ] Dashboard principal do FinanÃ§as360
- [ ] RelatÃ³rio de Fluxo de Caixa
- [ ] DRE (Demonstrativo de Resultados)
- [ ] RelatÃ³rio de Contas a Pagar/Receber
- [ ] GrÃ¡ficos e indicadores financeiros

### Fase 7: IntegraÃ§Ãµes
- [ ] IntegraÃ§Ã£o com APIs bancÃ¡rias (se disponÃ­vel)
- [ ] ImportaÃ§Ã£o de extratos bancÃ¡rios
- [ ] ExportaÃ§Ã£o de dados para Excel/PDF
- [ ] IntegraÃ§Ã£o com sistema de notificaÃ§Ãµes

### Fase 8: Testes e OtimizaÃ§Ãµes
- [ ] Testes de integraÃ§Ã£o
- [ ] Testes de performance
- [ ] OtimizaÃ§Ã£o de queries
- [ ] DocumentaÃ§Ã£o completa

## ğŸ” PermissÃµes

### NÃ­veis de Acesso
1. **Admin Financeiro**: Acesso total ao mÃ³dulo
2. **Operador Financeiro**: CRUD em lanÃ§amentos e operaÃ§Ãµes
3. **Visualizador**: Apenas leitura de dados

### PermissÃµes EspecÃ­ficas
```typescript
const FIN360_PERMISSIONS = {
  // Cadastros
  'fin360.empresas.view': 'Visualizar empresas',
  'fin360.empresas.create': 'Criar empresas',
  'fin360.empresas.edit': 'Editar empresas',
  'fin360.empresas.delete': 'Excluir empresas',
  
  // OperaÃ§Ãµes
  'fin360.lancamentos.view': 'Visualizar lanÃ§amentos',
  'fin360.lancamentos.create': 'Criar lanÃ§amentos',
  'fin360.lancamentos.edit': 'Editar lanÃ§amentos',
  'fin360.lancamentos.pay': 'Baixar/Pagar lanÃ§amentos',
  'fin360.lancamentos.cancel': 'Cancelar lanÃ§amentos',
  
  // RelatÃ³rios
  'fin360.reports.view': 'Visualizar relatÃ³rios',
  'fin360.reports.export': 'Exportar relatÃ³rios',
};
```

## ğŸ“ ConsideraÃ§Ãµes TÃ©cnicas

1. **SeguranÃ§a**:
   - Criptografia de dados sensÃ­veis (API keys, etc)
   - Auditoria de todas as operaÃ§Ãµes financeiras
   - ValidaÃ§Ã£o rigorosa de permissÃµes

2. **Performance**:
   - Ãndices em campos de busca frequente
   - PaginaÃ§Ã£o em listagens
   - Cache de dados de cadastros bÃ¡sicos

3. **Usabilidade**:
   - Interface intuitiva similar ao padrÃ£o do sistema
   - Atalhos de teclado para operaÃ§Ãµes comuns
   - Autocompletar em campos de parceiros/contas

4. **Conformidade**:
   - Campos obrigatÃ³rios para compliance fiscal
   - HistÃ³rico completo de alteraÃ§Ãµes
   - Impossibilidade de exclusÃ£o de dados fiscais

## ğŸš€ PrÃ³ximos Passos

1. Validar este plano com vocÃª
2. ComeÃ§ar pela Fase 1 criando a estrutura base
3. Implementar incrementalmente cada fase
4. Testar e validar cada etapa antes de prosseguir

---

**Status**: Aguardando aprovaÃ§Ã£o para iniciar implementaÃ§Ã£o