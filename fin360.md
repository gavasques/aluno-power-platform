# Plano de Implementação - Módulo Finanças360

## 📋 Visão Geral

Integração completa do sistema de gestão financeira Finanças360 dentro do sistema atual, com foco em controle de finanças empresariais, incluindo cadastros e operações financeiras.

## 🎯 Objetivos

1. Criar módulo Finanças360 dentro de "Minha Área"
2. Implementar todos os cadastros financeiros
3. Implementar todas as operações financeiras
4. Integrar com sistema de permissões existente
5. Usar prefixo `fin360_` em todas as tabelas para evitar conflitos

## 🏗️ Arquitetura

### Estrutura de Pastas
```
client/src/
├── pages/myarea/financas360/
│   ├── Financas360Index.tsx          # Página principal com cards
│   ├── cadastros/
│   │   ├── Empresas.tsx
│   │   ├── Canais.tsx
│   │   ├── Bancos.tsx
│   │   ├── ContasBancarias.tsx
│   │   ├── FormasPagamento.tsx
│   │   ├── Parceiros.tsx
│   │   ├── CanaisPagamento.tsx
│   │   └── EstruturaDRE.tsx
│   └── operacoes/
│       ├── Lancamentos.tsx
│       ├── NotasFiscais.tsx
│       └── Devolucoes.tsx
├── components/financas360/
│   ├── common/
│   ├── forms/
│   └── tables/
├── hooks/financas360/
├── lib/services/financas360/
└── shared/types/financas360/

server/
├── routes/financas360/
├── services/financas360/
└── migrations/financas360/
```

## 📊 Estrutura de Dados

### Tabelas do Banco de Dados

#### 1. fin360_empresas
```sql
- id: serial primary key
- razao_social: varchar(255) not null
- nome_fantasia: varchar(255)
- cnpj: varchar(14) unique not null
- inscricao_estadual: varchar(20)
- inscricao_municipal: varchar(20)
- endereco: jsonb
- telefone: varchar(20)
- email: varchar(255)
- logo_url: text
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 2. fin360_canais
```sql
- id: serial primary key
- nome: varchar(100) not null
- descricao: text
- tipo: varchar(50) -- 'vendas', 'compras', 'servicos'
- cor: varchar(7) -- cor hexadecimal
- icone: varchar(50)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 3. fin360_bancos
```sql
- id: serial primary key
- codigo: varchar(10) unique not null
- nome: varchar(100) not null
- nome_completo: varchar(255)
- website: varchar(255)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
```

#### 4. fin360_contas_bancarias
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id)
- banco_id: integer references fin360_bancos(id)
- tipo_conta: varchar(20) -- 'corrente', 'poupanca', 'investimento'
- agencia: varchar(10) not null
- conta: varchar(20) not null
- digito: varchar(2)
- descricao: varchar(255)
- saldo_inicial: decimal(12,2) default 0
- saldo_atual: decimal(12,2) default 0
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 5. fin360_formas_pagamento
```sql
- id: serial primary key
- nome: varchar(100) not null
- tipo: varchar(50) -- 'dinheiro', 'cartao_credito', 'cartao_debito', 'pix', 'boleto', 'transferencia'
- taxa_percentual: decimal(5,2) default 0
- taxa_fixa: decimal(10,2) default 0
- prazo_recebimento: integer default 0 -- em dias
- conta_bancaria_id: integer references fin360_contas_bancarias(id)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 6. fin360_parceiros
```sql
- id: serial primary key
- tipo: varchar(20) -- 'cliente', 'fornecedor', 'ambos'
- razao_social: varchar(255)
- nome_fantasia: varchar(255)
- cpf_cnpj: varchar(14) unique
- inscricao_estadual: varchar(20)
- endereco: jsonb
- telefone: varchar(20)
- email: varchar(255)
- observacoes: text
- limite_credito: decimal(12,2) default 0
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 7. fin360_canais_pagamento
```sql
- id: serial primary key
- nome: varchar(100) not null
- tipo: varchar(50) -- 'gateway', 'maquininha', 'banco', 'fintech'
- taxa_percentual: decimal(5,2) default 0
- taxa_fixa: decimal(10,2) default 0
- prazo_recebimento: integer default 0
- configuracoes: jsonb -- API keys, etc (encrypted)
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 8. fin360_estrutura_dre
```sql
- id: serial primary key
- codigo: varchar(20) unique not null
- descricao: varchar(255) not null
- tipo: varchar(20) -- 'receita', 'custo', 'despesa'
- nivel: integer not null -- 1, 2, 3 (hierarquia)
- pai_id: integer references fin360_estrutura_dre(id)
- ordem: integer
- is_active: boolean default true
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 9. fin360_lancamentos
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- tipo: varchar(20) -- 'receita', 'despesa'
- data_lancamento: date not null
- data_vencimento: date not null
- data_pagamento: date
- parceiro_id: integer references fin360_parceiros(id)
- conta_bancaria_id: integer references fin360_contas_bancarias(id)
- forma_pagamento_id: integer references fin360_formas_pagamento(id)
- canal_id: integer references fin360_canais(id)
- estrutura_dre_id: integer references fin360_estrutura_dre(id)
- descricao: varchar(255) not null
- valor: decimal(12,2) not null
- valor_pago: decimal(12,2)
- juros: decimal(10,2) default 0
- multa: decimal(10,2) default 0
- desconto: decimal(10,2) default 0
- status: varchar(20) -- 'pendente', 'pago', 'cancelado', 'vencido'
- observacoes: text
- anexos: jsonb -- array de URLs
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 10. fin360_notas_fiscais
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- numero: varchar(20) not null
- serie: varchar(10)
- chave_acesso: varchar(44) unique
- tipo: varchar(20) -- 'entrada', 'saida'
- data_emissao: date not null
- data_entrada: date
- parceiro_id: integer references fin360_parceiros(id)
- valor_produtos: decimal(12,2) not null
- valor_desconto: decimal(10,2) default 0
- valor_frete: decimal(10,2) default 0
- valor_seguro: decimal(10,2) default 0
- outras_despesas: decimal(10,2) default 0
- valor_total: decimal(12,2) not null
- observacoes: text
- xml_url: text
- pdf_url: text
- status: varchar(20) -- 'autorizada', 'cancelada', 'inutilizada'
- lancamentos: jsonb -- array de IDs dos lançamentos vinculados
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

#### 11. fin360_devolucoes
```sql
- id: serial primary key
- empresa_id: integer references fin360_empresas(id) not null
- tipo: varchar(20) -- 'cliente', 'fornecedor'
- data: date not null
- parceiro_id: integer references fin360_parceiros(id)
- nota_fiscal_id: integer references fin360_notas_fiscais(id)
- motivo: text not null
- valor: decimal(12,2) not null
- status: varchar(20) -- 'pendente', 'processada', 'cancelada'
- lancamento_id: integer references fin360_lancamentos(id)
- observacoes: text
- created_at: timestamp
- updated_at: timestamp
- created_by: integer references users(id)
```

## 🔧 Plano de Implementação

### Fase 1: Preparação e Estrutura Base
- [ ] Criar estrutura de pastas para o módulo Finanças360
- [ ] Configurar rotas base no App.tsx
- [ ] Criar página Financas360Index.tsx com cards de navegação
- [ ] Adicionar card "Finanças360" em MinhaAreaIndex.tsx
- [ ] Criar tipos TypeScript base em shared/types/financas360/
- [ ] Configurar permissões no sistema de autenticação

### Fase 2: Schema e Migrações do Banco
- [ ] Criar schema completo em shared/schema/financas360.ts
- [ ] Implementar migrações para todas as tabelas
- [ ] Executar migrações no banco de dados
- [ ] Criar índices para otimização

### Fase 3: Serviços Backend
- [ ] Criar serviços base para CRUD de cada entidade
- [ ] Implementar validações com Zod
- [ ] Criar rotas da API para cada módulo
- [ ] Implementar middleware de autenticação/autorização
- [ ] Criar testes unitários para serviços

### Fase 4: Cadastros Básicos
- [ ] Implementar CRUD de Empresas
- [ ] Implementar CRUD de Canais
- [ ] Implementar CRUD de Bancos
- [ ] Implementar CRUD de Contas Bancárias
- [ ] Implementar CRUD de Formas de Pagamento
- [ ] Implementar CRUD de Parceiros
- [ ] Implementar CRUD de Canais de Pagamento
- [ ] Implementar CRUD de Estrutura DRE

### Fase 5: Operações Financeiras
- [ ] Implementar sistema de Lançamentos
  - [ ] Criar lançamento
  - [ ] Editar lançamento
  - [ ] Baixar/Pagar lançamento
  - [ ] Cancelar lançamento
  - [ ] Filtros e relatórios
- [ ] Implementar gestão de Notas Fiscais
  - [ ] Upload de XML
  - [ ] Parser de XML
  - [ ] Vinculação com lançamentos
  - [ ] Relatórios fiscais
- [ ] Implementar sistema de Devoluções
  - [ ] Criar devolução
  - [ ] Processar devolução
  - [ ] Gerar lançamentos de devolução

### Fase 6: Dashboards e Relatórios
- [ ] Dashboard principal do Finanças360
- [ ] Relatório de Fluxo de Caixa
- [ ] DRE (Demonstrativo de Resultados)
- [ ] Relatório de Contas a Pagar/Receber
- [ ] Gráficos e indicadores financeiros

### Fase 7: Integrações
- [ ] Integração com APIs bancárias (se disponível)
- [ ] Importação de extratos bancários
- [ ] Exportação de dados para Excel/PDF
- [ ] Integração com sistema de notificações

### Fase 8: Testes e Otimizações
- [ ] Testes de integração
- [ ] Testes de performance
- [ ] Otimização de queries
- [ ] Documentação completa

## 🔐 Permissões

### Níveis de Acesso
1. **Admin Financeiro**: Acesso total ao módulo
2. **Operador Financeiro**: CRUD em lançamentos e operações
3. **Visualizador**: Apenas leitura de dados

### Permissões Específicas
```typescript
const FIN360_PERMISSIONS = {
  // Cadastros
  'fin360.empresas.view': 'Visualizar empresas',
  'fin360.empresas.create': 'Criar empresas',
  'fin360.empresas.edit': 'Editar empresas',
  'fin360.empresas.delete': 'Excluir empresas',
  
  // Operações
  'fin360.lancamentos.view': 'Visualizar lançamentos',
  'fin360.lancamentos.create': 'Criar lançamentos',
  'fin360.lancamentos.edit': 'Editar lançamentos',
  'fin360.lancamentos.pay': 'Baixar/Pagar lançamentos',
  'fin360.lancamentos.cancel': 'Cancelar lançamentos',
  
  // Relatórios
  'fin360.reports.view': 'Visualizar relatórios',
  'fin360.reports.export': 'Exportar relatórios',
};
```

## 📝 Considerações Técnicas

1. **Segurança**:
   - Criptografia de dados sensíveis (API keys, etc)
   - Auditoria de todas as operações financeiras
   - Validação rigorosa de permissões

2. **Performance**:
   - Índices em campos de busca frequente
   - Paginação em listagens
   - Cache de dados de cadastros básicos

3. **Usabilidade**:
   - Interface intuitiva similar ao padrão do sistema
   - Atalhos de teclado para operações comuns
   - Autocompletar em campos de parceiros/contas

4. **Conformidade**:
   - Campos obrigatórios para compliance fiscal
   - Histórico completo de alterações
   - Impossibilidade de exclusão de dados fiscais

## 🚀 Próximos Passos

1. Validar este plano com você
2. Começar pela Fase 1 criando a estrutura base
3. Implementar incrementalmente cada fase
4. Testar e validar cada etapa antes de prosseguir

---

**Status**: Aguardando aprovação para iniciar implementação